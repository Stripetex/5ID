
import java.io.*;
import java.net.*;
import java.lang.Thread;

public class Echo {

	@SuppressWarnings("empty-statement")
	public static void main(String args[]) {

		ServerSocket echoServer = null;
		String line;
		BufferedReader is;
		PrintStream os;
		String[] key = {"passo", "e", "chiudo"};
		int cont;

		Socket clientSocket = null;
		try {
			echoServer = new ServerSocket(9999);
			System.out.println("Use \"netcat 127.0.0.1 9999\"");
		} catch (IOException e) {
			System.out.println(e);
		}
		try {
			clientSocket = echoServer.accept();
			is = new BufferedReader(new InputStreamReader(clientSocket.getInputStream()));
			os = new PrintStream(clientSocket.getOutputStream());
			cont = 0;
			while (true) {
				line = is.readLine();
				Thread.sleep(1000);
				if (line.toLowerCase().equals(key[cont])) {
					cont++;
					if (cont == 3) {
						os.println("ECHO Chiudo la comunicazione");
						clientSocket.close();
						echoServer.close();
					}

				} else {
					cont=0;
					os.println("ECHO " + line);
				}
			}
		} catch (IOException e) {
			System.out.println(e);
		} catch (InterruptedException ie) {
			System.out.println(ie);
		}
	}
}
